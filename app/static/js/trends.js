document.addEventListener('DOMContentLoaded', function() {
    
    // Инициализация графиков
    initCharts();
    
    // Обработка фильтров
    document.getElementById('apply-trend-filters').addEventListener('click', function() {
        updateCharts();
    });
});document.addEventListener('DOMContentLoaded', function() {
    const reviewsData = [
        {
            id: 1,
            author: "Константин",
            rating: "★★★★★",
            date: "15.08.2024",
            tourId: "1",
            tourName: "Золотое кольцо",
            text: 'В целом, тур был очень хорошо организован. Мы посетили множество исторических мест, и каждый день был насыщен событиями. Ярославль оставил самые яркие впечатления — его архитектура просто потрясающая! Единственный минус — иногда было мало свободного времени для прогулок, но это мелочи по сравнению с теми эмоциями, которые мы получили. Спасибо организаторам!'
        },
        {
            id: 2,
            author: "Екатерина",
            rating: "★★★★★",
            date: "10.07.2024",
            tourId: "8",
            tourName: "Озеро Байкал",
            text: 'Тур "Озеро Байкал" превзошел все мои ожидания! Каждый день был насыщен интересными экскурсиями и уникальными моментами. Особенно запомнился мыс Хобой — виды с этого места просто завораживают! Проживание и питание были на высоком уровне, а наши гиды были очень профессиональными и дружелюбными. Я обязательно вернусь на Байкал!'
        },
        {
            id: 3,
            author: "Андрей",
            rating: "★★★☆☆",
            date: "25.06.2025",
            tourId: "2",
            tourName: "Путешествие по Карелии",
            text: 'В целом, тур оставил положительные эмоции. Санкт-Петербург и Петрозаводск — прекрасные города с богатой историей. Экскурсии были хорошо организованы, а транспорт комфортный. Единственное, хотелось бы больше времени на самостоятельные прогулки в Петрозаводске и Сортавале. Но это не испортило общего впечатления. Спасибо организаторам за отличный отдых!'
        },
        {
            id: 4,
            author: "Людмила",
            rating: "★★★★★",
            date: "12.05.2025",
            tourId: "7",
            tourName: "Приключения на Кавказе",
            text: 'Это было невероятное путешествие! Я в восторге от природы Кавказа — горы, водопады, альпийские луга. Особенно впечатлил поход в Приэльбрусье. Гиды были очень профессиональными и всегда готовы помочь. Ужин в ресторане с осетинской кухней стал настоящим кулинарным праздником. Спасибо организаторам за такой замечательный тур!'
        },
        {
            id: 5,
            author: "Генадий",
            rating: "★★★☆☆",
            date: "03.09.2023",
            tourId: "3",
            tourName: "Сибирское путешествие",
            text: 'Тур оказался довольно интересным, но были моменты, которые можно было бы улучшить. Например, хотелось бы больше времени на самостоятельные прогулки в городах. Тем не менее, экскурсии были познавательными, а гиды — профессиональными. Природа Сибири действительно впечатляет, особенно во время походов в заповеднике. В целом, я остался доволен поездкой.'
        },
        {
            id: 6,
            author: "Иван",
            rating: "★★★★★",
            date: "12.05.2023",
            tourId: "4",
            tourName: "Сказочный Алтай",
            text: 'Я в полном восторге от тура! Все дни были организованы на высшем уровне: от проживания до питания. Прогулка по Чуйскому тракту была просто незабываемой — горные пейзажи завораживают! Ужин в кемпинге с костром стал настоящим приключением. Я также приняла участие в мастер-классе по алтайским ремеслам и осталась довольна результатом. Обязательно вернусь сюда снова!'
        },
        {
            id: 7,
            author: "Игорь",
            rating: "★★★★☆",
            date: "15.07.2024",
            tourId: "5",
            tourName: "Дагестан",
            text: 'Тур "Сокровища Дагестана" оставил положительное впечатление. Программа была насыщенной и интересной, особенно мне понравился Лезгинский национальный парк с его уникальной флорой и фауной. Однако я бы хотел больше времени на отдых на пляже Каспийского моря. В целом, это замечательный способ провести время с семьей и узнать новое!'
        },
        {
            id: 8,
            author: "Ева",
            rating: "★★★★☆",
            date: "18.08.2024",
            tourId: "6",
            tourName: "Северная Осетия",
            text: 'Я осталась в полном восторге от тура! Каждый день был наполнен новыми открытиями и впечатлениями. Пеший поход по Цейскому ущелью стал одним из самых ярких моментов — природа просто потрясающая! Также мне понравился мастер-класс по приготовлению осетинских пирогов — это было весело и познавательно. Спасибо организаторам за чудесный отдых!'
        },
        {
            id: 9,
            author: "Лиза",
            rating: "★★★★★",
            date: "10.05.2025",
            tourId: "9",
            tourName: "Сокровища Сахалина",
            text: 'Тур "Сокровища Сахалина" стал для меня настоящим открытием! Каждый день был насыщен интересными экскурсиями и потрясающими пейзажами. Особенно запомнился визит на остров Итуруп — горячие источники и водопады просто завораживают! Гиды были очень профессиональными и дружелюбными, а местная кухня не оставила равнодушной. Я рекомендую этот тур всем любителям природы и приключений!'
        },
        {
            id: 10,
            author: "Мария",
            rating: "★★★★☆",
            date: "11.09.2024",
            tourId: "10",
            tourName: "Ингушетия",
            text: 'Это путешествие превзошло все мои ожидания! Ингушетия — невероятно красивый регион с богатой историей. Программа тура была насыщенной, но не утомительной. Я в восторге от музея ингушского народа — там столько интересного! Также хочу отметить качество проживания и питания — все было на высшем уровне. Спасибо организаторам за незабываемые впечатления!'
        },
        {
            id: 11,
            author: "Ада",
            rating: "★★★★☆",
            date: "14.04.2024",
            tourId: "11",
            tourName: "Ивановские озера Хакасии",
            text: 'Тур "Ивановские озера" превзошел все мои ожидания! Природа Хакасии просто завораживает — особенно Ивановские озера с их бирюзовой водой. Гиды были очень профессиональными и делились множеством интересных фактов. Ужин с традиционными хакасскими блюдами был настоящим кулинарным праздником! Обязательно вернусь сюда еще раз!'
        },
        {
            id: 12,
            author: "Савелий",
            rating: "★★★★☆",
            date: "10.02.2023",
            tourId: "12",
            tourName: "Южно-Чуйское кольцо",
            text: 'Тур прошел на высоком уровне. Природа Алтая впечатляет своей красотой, а конные прогулки — это просто супер! Но я бы предложил добавить больше информации о местах, которые мы посещаем. Например, хотелось бы больше узнать о кургане "Скрижаль". В целом, я остался доволен и готов рекомендовать этот тур своим друзьям.'
        },
        {
            id: 13,
            author: "Жан",
            rating: "★★★★☆",
            date: "12.12.2023",
            tourId: "14",
            tourName: "Загадки Кольского полуострова",
            text: 'Тур "Загадки Кольского полуострова" оправдал все ожидания. Программа была насыщенной и интересной. Особенно впечатлила экскурсия по сосновому бору и озеру Имандра — место просто волшебное. Однако я бы предпочел больше времени на отдых после активных дней. Но в целом, это отличный способ увидеть красивую природу и культуру региона.'
        },
        {
            id: 14,
            author: "Виктор",
            rating: "★★★★★",
            date: "22.10.2023",
            tourId: "15",
            tourName: "Солнечный Крым",
            text: 'Тур "Солнечный Крым" оказался очень интересным и познавательным. Мне особенно понравилась экскурсия по Феодосии и посещение картинной галереи Айвазовского. Однако я бы хотел больше времени провести на пляже в Феодосии — там было так приятно! В целом, все было очень хорошо организовано, и я остался доволен путешествием.'
        },
        {
            id: 15,
            author: "Aнна",
            rating: "★★★★★",
            date: "29.09.2024",
            tourId: "1",
            tourName: "Золотое кольцо",
            text: 'Тур "Золотое кольцо" стал для меня настоящим открытием! Каждый день был наполнен интересными экскурсиями и новыми впечатлениями. Особенно запомнилась Троице-Сергиева лавра в Сергиевом Посаде — это место просто завораживает своей атмосферой. Проживание и питание были на высоком уровне, а гиды отлично знали материал. Рекомендую всем, кто хочет узнать больше о русской культуре и истории!'
        },
        {
            id: 16,
            author: "Дмитрий",
            rating: "★★★★☆",
            date: "27.07.2023",
            tourId: "2",
            tourName: "Путешествие по Карелии",
            text: 'Хороший тур для тех, кто хочет увидеть красоту Карелии. Программа была насыщенной, и каждый день приносил новые впечатления. Водопад Ахвенкоски и мраморный каньон — это действительно стоит увидеть! Однако я бы хотел больше информации о местной культуре и традициях. В целом, путешествие было удачным, и я рекомендую его друзьям.'
        },
        {
            id: 17,
            author: "Галина",
            rating: "★★★★☆",
            date: "03.10.2024",
            tourId: "3",
            tourName: "Сибирское путешествие",
            text: 'Сибирское путешествие превзошло все мои ожидания! Я была поражена красотой природы и разнообразием культурных достопримечательностей. Горно-Алтайск и Томск оставили самые яркие впечатления. Программа тура была хорошо организована, а группа подобралась замечательная. Ужин в традиционном алтайском стиле был просто незабываемым! Обязательно порекомендую этот тур своим друзьям.'
        },
        {
            id: 18,
            author: "Виктор",
            rating: "★★★☆☆",
            date: "25.05.2025",
            tourId: "4",
            tourName: "Сказочный Алтай",
            text: 'В целом, тур оставил положительные эмоции. Программа была насыщенной и интересной, особенно мне понравился день на озере Ая — вода была теплой, а пляж чистым. Единственное, что можно улучшить — это время на остановках для фотографий. Но в целом, это отличный способ увидеть красоту Алтая и познакомиться с его культурой. Гиды были очень профессиональными и дружелюбными.'
        },
        {
            id: 19,
            author: "Анна",
            rating: "★★★★☆",
            date: "21.06.2024",
            tourId: "5",
            tourName: "Дагестан",
            text: 'Тур "Сокровища Дагестана" превзошел все мои ожидания! Каждый день был наполнен новыми открытиями и впечатлениями. Особенно запомнился Сулакский каньон — его красота просто захватывает дух! Ужин в традиционных ресторанах был настоящим кулинарным путешествием. Гиды были очень профессиональными и делились интересными историями о каждом месте. Я обязательно вернусь в Дагестан!'
        },
        {
            id: 20,
            author: "Марина",
            rating: "★★★★★",
            date: "12.06.2025",
            tourId: "6",
            tourName: "Северная Осетия",
            text: 'Это путешествие превзошло все мои ожидания! Я влюбилась в Северную Осетию с первого взгляда. Владикавказ оказался очень уютным городом с дружелюбными людьми. Прогулка по Архонской долине была просто волшебной! Ужин в традиционном ауле стал настоящим праздником для вкусовых рецепторов. Обязательно вернусь сюда снова!'
        },
        {
            id: 21,
            author: "Павел",
            rating: "★★★☆☆",
            date: "09.01.2023",
            tourId: "7",
            tourName: "Приключения на Кавказе",
            text: 'Тур организован очень качественно, все было по расписанию. Мне понравилось разнообразие мест, которые мы посетили — от исторических достопримечательностей до живописных природных ландшафтов. Подъем на гору Бештау в Железноводске стал отличным завершением тура. Однако хотелось бы больше информации о местной культуре и обычаях. В целом, отличный отдых!'
        },
        {
            id: 22,
            author: "Татьяна",
            rating: "★★★★★",
            date: "21.11.2023",
            tourId: "8",
            tourName: "Озеро Байкал",
            text: 'Это путешествие стало для меня настоящим открытием! Байкал — это нечто невероятное. Все было прекрасно организовано: от размещения до экскурсий. Мне особенно понравился Байкальский музей — очень познавательно и интересно. Ужин в Листвянке с видом на озеро стал настоящим кулинарным праздником. Рекомендую всем любителям природы и приключений!'
        },
        {
            id: 23,
            author: "Влад",
            rating: "★★★★★",
            date: "23.08.2024",
            tourId: "9",
            tourName: "Сокровища Сахалина",
            text: 'Тур "Сокровища Сахалина" оказался очень интересным и насыщенным. Мы посетили множество красивых мест и узнали много нового о культуре и природе региона. Особенно впечатлил заповедник "Курильский" — возможность наблюдать за дикой природой была незабываемой. Однако я бы хотел немного больше свободного времени на Итурупе. В целом, я остался доволен!'
        },
        {
            id: 24,
            author: "София",
            rating: "★★★★☆",
            date: "12.05.2023",
            tourId: "10",
            tourName: "Ингушетия",
            text: 'Тур в Ингушетию стал для меня настоящим открытием! Программа была отлично организована, и каждый день был наполнен новыми впечатлениями. Особенно запомнились посещение ингушских башен и прогулка по живописным ущельям. Гиды были очень знающими и делились интересными фактами о культуре и истории региона. Ужин в ресторане с традиционной кухней был восхитительным! Рекомендую всем!'
        },
        {
            id: 25,
            author: "Дмитрий",
            rating: "★★★★☆",
            date: "15.10.2025",
            tourId: "11",
            tourName: "Ивановские озера Хакасии",
            text: 'Тур в Хакасию оказался очень интересным и познавательным. Природа потрясающая, а экскурсии были хорошо организованы. Особенно запомнился поход к водопадам — это было что-то невероятное! Однако хотелось бы больше времени уделить исследованию окрестностей. В целом, впечатления остались положительными.'
        },
        {
            id: 26,
            author: "Магамед",
            rating: "★★★★☆",
            date: "26.10.2024",
            tourId: "12",
            tourName: "Южно-Чуйское кольцо",
            text: 'Это было одно из лучших путешествий в моей жизни! Я никогда не думала, что конные туры могут быть такими увлекательными. Каждый день приносил новые открытия и эмоции. Особенно запомнился пикник на берегу реки Чуя — это было просто волшебно! Я вернусь сюда еще раз, чтобы заново насладиться всеми красотами Алтая!'
        },
        {
            id: 27,
            author: "Ирина",
            rating: "★★★★★",
            date: "25.07.2025",
            tourId: "14",
            tourName: "Загадки Кольского полуострова",
            text: 'Тур "Загадки Кольского полуострова" стал для меня настоящим открытием! Мурманск оказался гораздо интереснее, чем я ожидала. Обзорная экскурсия была очень познавательной, а океанариум — настоящим украшением первого дня. Особенно запомнился подъем на Айкуайвенчорр — виды просто захватывающие! Наблюдение северного сияния стало финальным аккордом нашего путешествия. Рекомендую всем!'
        },
        {
            id: 28,
            author: "Елена",
            rating: "★★★★★",
            date: "04.04.2024",
            tourId: "15",
            tourName: "Солнечный Крым",
            text: 'Это был один из лучших туров в моей жизни! Природа Крыма просто завораживает, а экскурсии были очень информативными и увлекательными. Подъем на гору Ай-Петри стал одним из самых ярких моментов — виды оттуда просто потрясающие! Также хочу отметить отличное питание и комфортные условия проживания. Обязательно вернусь снова!'
        }
    ];
    // Инициализация графиков с данными из отзывов
    initCharts(reviewsData);
    
    // Обработка фильтров
    document.getElementById('apply-trend-filters').addEventListener('click', function() {
        updateCharts(reviewsData);
    });
});
// Header scroll effect
window.addEventListener('scroll', function() {
    const header = document.querySelector('.header');
    if (window.scrollY > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
});

// Mobile menu toggle
const menuToggle = document.querySelector('.menu-toggle');
const nav = document.querySelector('.nav');

menuToggle.addEventListener('click', function() {
    nav.classList.toggle('active');
    menuToggle.innerHTML = nav.classList.contains('active') ? 
        '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
});

// Close menu when clicking on a link
document.querySelectorAll('.nav a').forEach(link => {
    link.addEventListener('click', () => {
        nav.classList.remove('active');
        menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
    });
});

// Hide filters on scroll down, show on scroll up
let lastScroll = 0;
const filters = document.querySelector('.trends-filters');
const filtersHeight = filters.offsetHeight;
const headerHeight = document.querySelector('.header').offsetHeight;
const scrollOffset = headerHeight + filtersHeight;

window.addEventListener('scroll', function() {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll <= scrollOffset) {
        filters.classList.remove('hidden');
        return;
    }
    
    if (currentScroll > lastScroll && !filters.classList.contains('hidden')) {
        // Scroll down
        filters.classList.add('hidden');
    } else if (currentScroll < lastScroll && filters.classList.contains('hidden')) {
        // Scroll up
        filters.classList.remove('hidden');
    }
    
    lastScroll = currentScroll;
});

// Animation on scroll for trend cards
function animateCards() {
    const cards = document.querySelectorAll('.trend-card');
    const windowHeight = window.innerHeight;
    
    cards.forEach((card, index) => {
        const cardPosition = card.getBoundingClientRect().top;
        const animationDelay = index * 0.1;
        
        if (cardPosition < windowHeight - 100) {
            card.classList.add('animated');
            card.style.transitionDelay = `${animationDelay}s`;
        }
    });
}

// Initialize animations
window.addEventListener('load', animateCards);
window.addEventListener('scroll', animateCards);
function initCharts() {
    // График популярных регионов
    const regionsCtx = document.getElementById('popularRegionsChart').getContext('2d');
    const regionsChart = new Chart(regionsCtx, {
        type: 'bar',
        data: {
            labels: ['Карелия', 'Байкал', 'Камчатка', 'Золотое кольцо', 'Крым', 'Алтай'],
            datasets: [{
                label: 'Количество туристов',
                data: [1250, 980, 870, 760, 680, 520],
                backgroundColor: [
                    'rgba(42, 95, 143, 0.7)',
                    'rgba(58, 127, 191, 0.7)',
                    'rgba(74, 159, 239, 0.7)',
                    'rgba(231, 76, 60, 0.7)',
                    'rgba(243, 156, 18, 0.7)',
                    'rgba(46, 204, 113, 0.7)'
                ],
                borderColor: [
                    'rgba(42, 95, 143, 1)',
                    'rgba(58, 127, 191, 1)',
                    'rgba(74, 159, 239, 1)',
                    'rgba(231, 76, 60, 1)',
                    'rgba(243, 156, 18, 1)',
                    'rgba(46, 204, 113, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // График сезонности
    const seasonalityCtx = document.getElementById('seasonalityChart').getContext('2d');
    const seasonalityChart = new Chart(seasonalityCtx, {
        type: 'line',
        data: {
            labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
            datasets: [{
                label: 'Активность туристов',
                data: [15, 20, 35, 55, 80, 95, 100, 98, 75, 50, 30, 20],
                fill: true,
                backgroundColor: 'rgba(42, 95, 143, 0.1)',
                borderColor: 'rgba(42, 95, 143, 1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });

    // График бюджетов
    const budgetCtx = document.getElementById('budgetChart').getContext('2d');
    const budgetChart = new Chart(budgetCtx, {
        type: 'doughnut',
        data: {
            labels: ['До 20 тыс.', '20-50 тыс.', '50-100 тыс.', 'Более 100 тыс.'],
            datasets: [{
                data: [25, 45, 20, 10],
                backgroundColor: [
                    'rgba(42, 95, 143, 0.7)',
                    'rgba(58, 127, 191, 0.7)',
                    'rgba(74, 159, 239, 0.7)',
                    'rgba(231, 76, 60, 0.7)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // График типов путешественников
    const travelersCtx = document.getElementById('travelerTypesChart').getContext('2d');
    const travelersChart = new Chart(travelersCtx, {
        type: 'pie',
        data: {
            labels: ['Семьи', 'Пары', 'Соло', 'Друзья'],
            datasets: [{
                data: [40, 30, 15, 15],
                backgroundColor: [
                    'rgba(42, 95, 143, 0.7)',
                    'rgba(231, 76, 60, 0.7)',
                    'rgba(243, 156, 18, 0.7)',
                    'rgba(46, 204, 113, 0.7)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Сохраняем ссылки на графики для обновления
    window.trendCharts = {
        regions: regionsChart,
        seasonality: seasonalityChart,
        budget: budgetChart,
        travelers: travelersChart
    };
}

function updateCharts() {
    const period = document.getElementById('time-period').value;
    const travelerType = document.getElementById('traveler-type').value;
    
    // Здесь должен быть реальный запрос к API с фильтрами
    // Для демо просто обновим данные случайным образом
    
    // Обновляем график популярных регионов
    const newRegionsData = Array(6).fill().map(() => Math.floor(Math.random() * 500) + 500);
    window.trendCharts.regions.data.datasets[0].data = newRegionsData;
    window.trendCharts.regions.update();
    
    // Обновляем график сезонности
    const newSeasonData = Array(12).fill().map(() => Math.floor(Math.random() * 50) + 50);
    window.trendCharts.seasonality.data.datasets[0].data = newSeasonData;
    window.trendCharts.seasonality.update();
    
    // Показываем загрузку
    document.getElementById('apply-trend-filters').textContent = 'Загрузка...';
    setTimeout(() => {
        document.getElementById('apply-trend-filters').textContent = 'Применить';
    }, 800);
}
